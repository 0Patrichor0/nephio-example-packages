import os
from pathlib import Path

def generate_rag_markdown(repo_path, output_file):
    repo_path = Path(repo_path)
    with open(output_file, 'w', encoding='utf-8') as f:
        f.write("# Nephio è“å›¾åŒ…çŸ¥è¯†åº“ (Processed for RAGFlow)\n\n")
        f.write("æ­¤æ–‡æ¡£åŒ…å«äº† Nephio é¡¹ç›®ä¸­çš„æ ¸å¿ƒè“å›¾å®šä¹‰ï¼ŒåŒ…æ‹¬ Kptfile å’Œèµ„æºé…ç½®ã€‚\n\n---\n\n")

        # éå†æ‰€æœ‰æ–‡ä»¶å¤¹
        for root, dirs, files in os.walk(repo_path):
            # è¿‡æ»¤æ‰éšè—æ–‡ä»¶å¤¹å’ŒéåŒ…ç›®å½•
            if '.git' in root or '.github' in root:
                continue
            
            # æ£€æŸ¥å½“å‰ç›®å½•ä¸‹æ˜¯å¦æœ‰ Kptfileï¼Œä»¥æ­¤åˆ¤æ–­æ˜¯å¦ä¸ºä¸€ä¸ª Nephio åŒ…
            if 'Kptfile' in files:
                rel_path = os.path.relpath(root, repo_path)
                f.write(f"## ğŸ“¦ è“å›¾åŒ…è·¯å¾„: {rel_path}\n")
                f.write(f"**åŒ…æè¿°**: ä½äº `{rel_path}` çš„ Nephio å®˜æ–¹ç¤ºä¾‹åŒ…ã€‚\n\n")

                # ä¼˜å…ˆå¤„ç† Kptfile
                for file_name in sorted(files):
                    if file_name == 'Kptfile' or file_name.endswith(('.yaml', '.yml')):
                        file_path = Path(root) / file_name
                        try:
                            content = file_path.read_text(encoding='utf-8')
                            f.write(f"### ğŸ“„ æ–‡ä»¶: {file_name}\n")
                            f.write(f"å…³è”è·¯å¾„: `{rel_path}/{file_name}`\n")
                            f.write(f"```yaml\n{content}\n```\n\n")
                        except Exception as e:
                            print(f"æ— æ³•è¯»å–æ–‡ä»¶ {file_path}: {e}")
                
                f.write("---\n\n")

if __name__ == "__main__":
    # è¯·ç¡®ä¿ä½ å·²ç» git clone äº†ä»“åº“
    repo_dir = "./nephio-example-packages" 
    output_md = "nephio_knowledge_base.md"
    
    if os.path.exists(repo_dir):
        generate_rag_markdown(repo_dir, output_md)
        print(f"æˆåŠŸï¼æ•´ç†åçš„çŸ¥è¯†åº“å·²ä¿å­˜è‡³: {output_md}")
    else:
        print("é”™è¯¯ï¼šæœªæ‰¾åˆ°ä»“åº“ç›®å½•ï¼Œè¯·æ£€æŸ¥è·¯å¾„ã€‚")
